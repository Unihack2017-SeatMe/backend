{"version":3,"sources":["webpack:///webpack/bootstrap 6712cc6e4c220ca2df0e","webpack:///external \"mobx\"","webpack:///./src/index.js","webpack:///./src/setupServer.js","webpack:///external \"express\"","webpack:///external \"morgan\"","webpack:///external \"body-parser\"","webpack:///external \"socket.io\"","webpack:///external \"http\"","webpack:///./src/shared/socket-keys.js","webpack:///./src/shared/state/dummyState.jsx","webpack:///./src/shared/model/MapState.jsx","webpack:///./src/shared/model/LOCATIONS.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AC7DA,iC;;;;;;;;;;ACAA,0CAA4C;AAC5C,yCAAqD;AACrD,IAAW,UAAU,QAAI,IAAK,QAAS;AACvC,cAAW,YAAC,aAAQ,UAAW,S;;;;;;;;;;ACH/B,oCAAmC;AAEnC,mCAAiC;AACjC,uCAA0C;AAC1C,qCAAsC;AACtC,iCAA6B;AAC7B,mCAA+B;AAC/B,0CAAsD;AACtD,gCAAwC,UAChC;oBAAqB,YAAS,SAAI,IAC9B,YACA;eAGZ;AAAC;;AACD,qBAA6B,UAAM,MAEjC;UAAS,MAET;UAAY,SAAO,KAAO,OAE1B;UAAQ,KAAW,SAEb;WAAO,OAAK,MAAW,WAAW,WAAE,MACjC;gBAAI,IAA0B,4BACpC;AAC+C;AACgB;AAC/D;QAAI,IAAO,OACX;QAAI,IAAW,WACf;QAAI,IAAW,WAAW,WAAC,EAAU,UAErC;QAAI,IAAI,KAAE,CAAI,KAAK,QACjB;YAAK,KAAC,EAAO,OACf;AAEA;QAAK,KAAW,YAAE,CAAI,KAAK,QACpB;iBAAY,YAAI,IACjB;gBAAK,KAAI,IACb;YAAO,OACP;YAAK,KACP;AAEH;WAAO,QAAC,MACJ;WAAK,KACN,cAAc,gBACQ,uBAEtB;AAED;OAAG,GAAa,cAAS,UAClB;gBAAK,KACN;eAAK,KACT,cAAc,gBACQ,uBAExB;AAGuC;AACtC;QAAI,IAAC,CAAI,KAAK,KAAM,SACrB;YAAO,MAAG,IAAS,MAChB;YAAO,SACN;aACH;AAEa;AACb;QAAI,IAAC,CAAI,KAAK,KAAK,KAAM,SACwB;AAC/C;YAAO,OAAQ,UAAM,IACrB;YAAO,OAAM,QAAM,IAAI,IAAI,IAAO,WAAkB,gBAAM,MAErC;AACrB;YAAO,OAAI,IAAO,UAClB;YAAO,OAGd;AAAC;;AAEQ,sBAAW,Y;;;;;;AC/EpB,oC;;;;;;ACAA,mC;;;;;;ACAA,wC;;;;;;ACAA,sC;;;;;;ACAA,iC;;;;;;;;;;ACAa,QAAW,cAAe;AAC1B,QAAc,iBAAkB,gB;;;;;;;;;;ACD7C,uCAA6C;AAC7C,IAAa,YAAK;AAClB,MAAc,WAAO;AACrB,IAAgB,eAAM;AACtB,MAAa,UAAM;AAChB,KAAC,IAAK,IAAI,GAAG,IAAI,GAAK,KAChB;YAAK,MACT;eAKA;AACS;AAJH;oBAKV;;AACD,MAAc,WAAG,IAAI,WAAQ,SAAC,IAAO,IAAW;AACvC,mBAAQ,S;;;;;;;;;;;;;;;;;;;;AChBjB,mCAAoD;AAEpD,wCAAoC;eAEpC;gBAG6B,iBAD3B;aAAY,eAEN;aAAa,eAClB;AAGU;gBAAS,UACqD;AACnE;aAAY,YACjB;AAGU;gBAAS,UACd;aAAa,aAAI,IAAS,SAAG,IAClC;AAGD;QAAe,cACP;eAAK,KACZ;AAGD;QAAkB,iBAChB;cAAY,SACR;aAAC,MAAM,CAAI,KAAE,EAAM,OAAY,eAAQ,KAAa,aAChD;mBAAK;sBAEC;;0BACF,YAAS,QAAK,KACf;AAEN;AACO;AAJF;;0BAMO;iCAAE,CAAC,YAAS,QAAK,KAAY,YAAI,IAAC,CAAC,CAAI,KAAM,SAAK,CAAI,KAGtE;AAJS;AAPF;AAYF;eAET;;AAvCC;;AADA,YADC,OAAU,yFACS;AAMpB,YADC,OAAM,qKAIN;AAGD,YADC,OAAM,qKAGN;AAGD,YADC,OAAQ,sHAGR;AAGD,YADC,OAAQ,yHAkBR;AAGM,mBAAQ;AACjB,kBAAwB,S;;;;;;;;;;ACjDxB,MAAe;;cAGA;qBAAE,CACX,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAGZ;AATK;;cAWO;qBAAE,CACX,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAGZ;AATK;;cAWO;qBAAE,CACX,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAGZ;AATK;;cAWO;qBAAE,CACX,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAGZ;AATK;;cAWO;qBAAE,CACX,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAAW,WACpB,CAAC,CAAQ,SAGb;AATM;AAzCL;AAoDH,kBAAyB,U","file":"backend-compiled-debug.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6712cc6e4c220ca2df0e","module.exports = require(\"mobx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mobx\"\n// module id = 0\n// module chunks = 0","import { setupServer } from './setupServer';\r\nimport { mapState } from './shared/state/dummyState';\r\nlet envPort = process.env.PORT || 8080;\r\nsetupServer(mapState, envPort);\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import * as express from 'express';\r\nimport * as path from 'path';\r\nimport * as logger from 'morgan';\r\nimport * as bodyParser from 'body-parser';\r\nimport * as SocketIo from 'socket.io';\r\nimport * as http from 'http';\r\nimport { autorun } from 'mobx'; \r\nimport { allRoomDataKey } from './shared/socket-keys';\r\nfunction createJsonFromMapState(mapState) {\r\n  return mapState.allRoomData.values().map(\r\n    roomData => {\r\n      return roomData;\r\n    }\r\n  )\r\n}\r\nfunction setupServer(mapState, port) {\r\n\r\n  const app = express();\r\n\r\n  const server = http.Server(app);\r\n\r\n  const io = SocketIo(server);\r\n\r\n  server.listen(port, undefined, undefined, () => {\r\n    console.log(\"Server running on port \" + port);\r\n  });\r\n  // uncomment after placing your favicon in /public\r\n  //app.use(favicon(path.join(__dirname, 'public', 'favicon.ico')));\r\n  app.use(logger('dev'));\r\n  app.use(bodyParser.json());\r\n  app.use(bodyParser.urlencoded({ extended: false }));\r\n\r\n  app.get('/', (req, res) => {\r\n    res.json({ hello: 'world' });\r\n  });\r\n\r\n  app.post('/devices', (req, res) => {\r\n    mapState.addRoomData(req.body);\r\n    console.info(req.body);\r\n    res.status(200);\r\n    res.json({});\r\n  });\r\n\r\n  autorun(()=>{\r\n    io.emit(\r\n     allRoomDataKey,\r\n     createJsonFromMapState(mapState)\r\n    );\r\n  });\r\n\r\n  io.on('connection', (socket) => {\r\n    console.info(\"Client connected\");\r\n    socket.emit(\r\n      allRoomDataKey,\r\n      createJsonFromMapState(mapState)\r\n    );\r\n  })\r\n\r\n\r\n  // catch 404 and forward to error handler\r\n  app.use((req, res, next) => {\r\n    var err = new Error('Not Found');\r\n    err.status = 404;\r\n    next(err);\r\n  });\r\n\r\n  // error handler\r\n  app.use((err, req, res, next) => {\r\n    // set locals, only providing error in development\r\n    res.locals.message = err.message;\r\n    res.locals.error = req.app.get('env') === 'development' ? err : {};\r\n\r\n    // render the error page\r\n    res.status(err.status || 500);\r\n    res.render('error');\r\n  });\r\n\r\n}\r\n\r\nexport { setupServer };\n\n\n// WEBPACK FOOTER //\n// ./src/setupServer.js","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"morgan\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"morgan\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 7\n// module chunks = 0","export const roomDataKey = 'room_data';\r\nexport const allRoomDataKey = 'all_room_data'\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/socket-keys.js","import { MapState } from '../model/MapState';\r\nlet currentId = 0;\r\nconst capacity = 100;\r\nlet currentCount = 30;\r\nconst initial = [];\r\nfor(let i = 0; i < 5; i++) {\r\n  initial.push([\r\n    i, \r\n    {\r\n      count: currentCount,\r\n      capacity\r\n    }\r\n  ]);\r\n  currentCount += 10;\r\n}\r\nconst mapState = new MapState(new Map(initial));\r\nexport { mapState };\n\n\n// WEBPACK FOOTER //\n// ./src/shared/state/dummyState.jsx","import { observable, computed, action } from 'mobx';\r\n\r\nimport LOCATIONS from './LOCATIONS';\r\n\r\nclass MapState {\r\n  @observable\r\n  allRoomState = null;\r\n  constructor(initialRoomData) {\r\n    this.allRoomState = initialRoomData;\r\n  }\r\n\r\n  @action\r\n  addRoomData(roomData) {\r\n    // TODO: Change this? Maybe keep a record of all room data across time.\r\n    this.setRoomData(roomData);\r\n  }\r\n\r\n  @action\r\n  setRoomData(roomData) {\r\n    this.allRoomState.set(roomData.id, roomData);\r\n  }\r\n\r\n  @computed\r\n  get allRoomData() {\r\n    return this.allRoomState;\r\n  }\r\n\r\n  @computed\r\n  get allRoomGeoData() {\r\n    const result = [];\r\n    for (const [key, {count, capacity}] of this.allRoomData) {\r\n      result.push({\r\n        type: 'Feature',\r\n        properties: {\r\n          name: LOCATIONS[key].name,\r\n          count,\r\n          capacity\r\n        },\r\n        geometry: {\r\n          type: 'Polygon',\r\n          coordinates: [LOCATIONS[key].coordinates.map(([lng, lat]) => [lat, lng])]\r\n        }\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nexport { MapState };\r\nexport default MapState;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/model/MapState.jsx","const LOCATIONS = {\r\n  0: {\r\n    name: 'Room 0',\r\n    coordinates: [\r\n      [-37.8165, 144.9628],\r\n      [-37.8163, 144.9628],\r\n      [-37.8163, 144.9627],\r\n      [-37.8165, 144.9627],\r\n      [-37.8165, 144.9628]\r\n    ]\r\n  },\r\n  1: {\r\n    name: 'Room 1',\r\n    coordinates: [\r\n      [-37.8162, 144.9628],\r\n      [-37.8160, 144.9628],\r\n      [-37.8160, 144.9627],\r\n      [-37.8162, 144.9627],\r\n      [-37.8162, 144.9628]\r\n    ]\r\n  },\r\n  2: {\r\n    name: 'Room 2',\r\n    coordinates: [\r\n      [-37.8165, 144.9631],\r\n      [-37.8163, 144.9631],\r\n      [-37.8163, 144.9630],\r\n      [-37.8165, 144.9630],\r\n      [-37.8165, 144.9631]\r\n    ]\r\n  },\r\n  3: {\r\n    name: 'Room 3',\r\n    coordinates: [\r\n      [-37.8165, 144.9638],\r\n      [-37.8163, 144.9638],\r\n      [-37.8163, 144.9637],\r\n      [-37.8165, 144.9637],\r\n      [-37.8165, 144.9638]\r\n    ]\r\n  },\r\n  4: {\r\n    name: 'Room 4',\r\n    coordinates: [\r\n      [-37.8165, 144.9648],\r\n      [-37.8163, 144.9648],\r\n      [-37.8163, 144.9647],\r\n      [-37.8165, 144.9647],\r\n      [-37.8165, 144.9648]\r\n    ]\r\n  }\r\n};\r\n\r\nexport default LOCATIONS;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/shared/model/LOCATIONS.js"],"sourceRoot":""}